# Project report (course submission)

## Aim

San Francisco’s EV adoption varies across the city. The aim of this project is to use data mining to:

1) **Segment** SF areas (ZIP codes) by EV adoption level, vehicle scale, and growth.
2) **Explain** co-occurring patterns across multiple attributes while avoiding false discoveries.
3) **Predict** next-year ZIP-level EV adoption using prior-year features.
4) **Detect anomalies** that might indicate unusual behavior or data quality issues.

**Primary use case:** inform *equitable EV infrastructure planning* (where to prioritize charging, outreach, and incentives).

## Data and storage

Data sources:
- CA DMV aggregated fuel type / vehicle counts by ZIP code (CSV).
- SF Open Data (Socrata API) example: Parking Meters (dataset ID `8vzz-qzz9`).

This repo uses a lightweight file-based data store:
- Raw inputs: `src/data_collection/data/raw/`
- Cleaned + engineered tables: `src/data_collection/data/processed/`
- Results artifacts for demo: `results/`

## Methods (data mining tasks)

### 1) Clustering
- Input: `sf_ev_features.csv` (ZIP × year features)
- Features: `ev_percentage`, `total_vehicles`, `ev_growth`
- Models: K-Means + DBSCAN
- Output: `results/clustering_results.csv`, `results/figures/clustering_analysis.png`

### 2) Association rule discovery (with false-discovery safeguards)
- Transactions: ZIP codes
- Items: discretized EV share bucket + high-share makes + duty mix flags
- Mining: Apriori + association rules (support/confidence/lift)
- Validity: permutation p-values on lift + Benjamini–Hochberg FDR
- Output: `results/association_rules.csv`, `results/figures/association_rules_top.png`

### 3) Predictive modeling
- Task: predict **next-year EV%** (year t → year t+1)
- Models: Ridge + RandomForestRegressor (regression), LogisticRegression + RandomForestClassifier (classification)
- Outputs: `results/predictive_modeling_metrics.csv`, `results/predictive_modeling_predictions.csv`, `results/models/*.joblib`

### 4) Anomaly detection
- Model: IsolationForest
- Features: EV adoption metrics + vehicle-mix concentration (HHI, top make share)
- Outputs: `results/anomaly_detection_results.csv`, `results/figures/anomaly_detection.png`

## Findings

See `results/headline_summary.md` (generated by `python scripts/summarize_headlines.py`).

Example highlight narratives:
- A high-adoption/high-growth cluster suggests where EV adoption is already accelerating.
- Low-adoption areas with high vehicle counts are candidates for equity-focused interventions.
- Anomalies highlight outliers like low-volume ZIPs (e.g., SFO) or abrupt growth changes that deserve investigation.

## Reproducibility

Quickstart:

```bash
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
python scripts/run_full_pipeline.py
python scripts/summarize_headlines.py
```

## Limitations

- ZIP codes are not neighborhoods; any ZIP→area label is approximate.
- DMV data is aggregated; conclusions are area-level.
- Association rules can overfit without validation; this repo includes permutation tests + BH-FDR but findings still require domain review.

## Demo checklist

- Run `python scripts/run_full_pipeline.py`
- Open figures in `results/figures/`
- Open `results/headline_summary.md` and narrate 1 key takeaway per method
